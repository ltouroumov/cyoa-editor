# V2 (NEO) Format

This is a high-level overview of the V2 format, see
the [type definitions](https://github.com/ltouroumov/cyoa-editor/tree/master/app/composables/project/types/v2) for
implementation details.

> **[!WARNING]**
> V2 format is not finalized and subject to change.

## Structure

The general project structure is as follows:

- `$schema` - schema version identifier
- `$project` - portable project metadata
- `config` - project configuration
- `content` - content
  - `objects` - object data (pages, rows, choices, addons), indexed by their ObjectID.
  - `children` - hierarchy relations, indexed by parent ObjectID.
  - `scores` - scores, indexed by ScoreID.
  - _..._ - other content types (tbd)
- `styles` - styles
  - `rules` - style rules, addressed by StyleID.
  - `defaults` - default style values for each component type.
- `media` - assets
  - `images` - list images used in the project, addressed by ImageID.

All entities in the projects are referenced by their unique ID, this allows for more efficient access, makes it easier
to share entities between objects (like styles and images), and simplifies the format itself compared to the nested
JSON structure of the V1 format.

## Object Types

Currently supported object types:

- **page** - top-level containers of the project, they allow multiple screens to be displayed.
  Note: currently, only one page is supported.
- **row** - group of choices, can be used to organize choices into logical groups and provide contextual information
  about them in the header.
- **choice** - single choice.
- **addon** - additional content for a choice.

## Component System

Choices and addons are built from pluggable components to define their appearance and behavior.

> TODO: add component system documentation (when it's finalized)

## Hierarchy

The project hierarchy is represented as a tree of objects (in the `content.children` map).
The keys of the map are ObjectIDs of the parent objects, and the values are the list of child objects, with additional
contextual information like the display size of the child.
This allows showing an object with different sizes in different rows.

## Planned Features

- Multiple screens to allow for multi-stage CYOAs or CYOAs with more complex structures.
- More built-in options (components) for "this choice contains other choices" (ie: allow picking sub-choices from a list
  or set of rows, with their own choice limit and/or sandboxed scores; this would make powers _Dynamist_ easier to
  manage for users).
- More template options for choices to allow for more complex layouts (like a choice with a header and a footer).
- Split the conditions for row display and "objects in this row can be chosen," to allow hiding a row while still
  allowing users to pick their choices (and keep the choices they picked if they hide the row).
- Support for complex conditions based on scores and the state of other objects (like "if the player has picked this
  choice 3 times").
- Support for "alternate scores" for choices, with an explicit default score, and optional score for different
  conditions (like "if the player has picked this other choice"); this will make it easier to display and search by
  scores.
- Support for dynamic choice content, like hiding a paragraph or changing specific words or values in a description
  based on the player's choices.
- (and whatever else comes to mind...)
